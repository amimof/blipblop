# TLS Certificates for voiyd

This directory contains example certificate configuration and helper commands for running voiyd components (server and nodes) over TLS.

The files are intended primarily for **local development and testing**. For any production or internet-facing deployment, you should generate and manage certificates according to your organization’s security policies (for example, using a corporate CA or a certificate management system like HashiCorp Vault, cert-manager, or a hardware security module).

## Contents

- `ca.conf` – OpenSSL configuration for generating a local Certificate Authority (CA) certificate.
- `ca.key` – Private key for the local CA (generated).
- `ca.crt` – Public certificate for the local CA (generated).
- `ca.srl` – CA serial file (generated by OpenSSL when signing certs).
- `server.conf` – OpenSSL configuration for generating the voiyd server certificate and CSR.
- `server.key` – Private key for the voiyd server (generated).
- `server.csr` – Certificate Signing Request for the voiyd server (generated).
- `server.crt` – Signed certificate for the voiyd server (generated).

## 1. Generate a Local CA

From the `certs/` directory, run:

```bash
# Generate a 2048-bit private key for the CA
openssl genrsa -out ca.key 2048

# Generate a self-signed CA certificate
openssl req -x509 -new -days 365 -sha256 -nodes \
  -key ca.key \
  -out ca.crt \
  -config ca.conf
```

This will create `ca.key` and `ca.crt` in the current directory.

## 2. Generate a Server Certificate

Next, generate a private key and certificate for the voiyd server. From the `certs/` directory, run:

```bash
# Generate a 2048-bit server private key
openssl genrsa -out server.key 2048

# Generate a certificate signing request (CSR) using server.conf
openssl req -new -sha256 \
  -key server.key \
  -out server.csr \
  -config server.conf

# Sign the CSR with the local CA to produce server.crt
openssl x509 -req -sha256 -days 365 \
  -in server.csr \
  -CA ca.crt \
  -CAkey ca.key \
  -CAcreateserial \
  -out server.crt \
  -extfile server.conf \
  -extensions v3_req
```

This will create `server.key`, `server.csr`, `server.crt`, and (if not present) `ca.srl`.

## 3. Configure voiyd to Use TLS

Exact flags and configuration options may vary, but at a high level, you will:

1. Configure the **voiyd server** to:
   - Use `server.crt` as its certificate.
   - Use `server.key` as its private key.
2. Configure **clients and nodes** to:
   - Trust `ca.crt` (for example, by pointing TLS settings at this file or adding it to the OS trust store in a development environment).

See [Quick Start](/README.md#quick-start) for how to start a secure cluster with the generated certificates.

## Security Considerations

- Keep private keys (`ca.key`, `server.key`) secure and limit access to them.
- For production:
  - Use strong key sizes and appropriate lifetimes for certificates.
  - Use a well-managed CA (internal PKI or an external provider).
  - Rotate certificates and keys regularly.
